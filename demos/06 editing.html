<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>步骤6：编辑模式切换</title>
    <style>
        [v-cloak]{display:none}
        body{font-family:system-ui;margin:20px}
        table{border-collapse:collapse;width:480px;max-width:100%}
        th,td{border:1px solid #ccc;padding:8px;text-align:left}
        .box{border:1px solid #ccc;padding:12px;margin-top:12px}
        label{display:inline-block;width:80px}
    </style>
</head>
<body>
<div id="app" v-cloak>
    <h1>{{ title }}</h1>

    <section v-if="!isEditing">
        <table>
            <thead>
            <tr>
                <th>名称</th>
                <th>血量</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="h in heroes" :key="h.id">
                <td>{{ h.name }}</td>
                <td>{{ h.hp }}</td>
                <td>
                    <button type="button" @click="startEditing(h.id)">编辑</button>
                </td>
            </tr>
            </tbody>
        </table>
    </section>

    <section v-else class="box">
        <div>
            <label>名称</label>
            <input type="text" :value="editForm.name" @input="onEditNameInput">
        </div>
        <div style="margin-top:8px">
            <label>血量</label>
            <input type="number" min="0" :value="editForm.hp" @input="onEditHpInput">
        </div>
        <div style="margin-top:8px">
            <button type="button" @click="cancelEditing">取消</button>
        </div>
    </section>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script>
    (function () {
        var ref = Vue.ref;
        var reactive = Vue.reactive;
        var computed = Vue.computed;

        function createEmptyHero() {
            return { id: 0, name: '', hp: '' };
        }

        function findHeroIndexById(list, heroId) {
            var i;
            for (i=0;i<list.length;i=i+1){
                if(list[i].id===heroId) return i;
            }
            return -1;
        }

        var app = Vue.createApp({
            setup: function () {
                var title = ref('英雄管理面板（步骤6）');
                var heroes = ref([
                    { id: 1, name: '盖伦', hp: 318 },
                    { id: 2, name: '提莫', hp: 320 },
                    { id: 3, name: '安妮', hp: 419 }
                ]);

                var editingId = ref(null);
                var editForm = reactive(createEmptyHero());

                var isEditing = computed(function () {
                    return editingId.value !== null;
                });

                function startEditing(heroId) {
                    var i = findHeroIndexById(heroes.value, heroId);
                    if (i === -1) return;
                    var h = heroes.value[i];
                    editingId.value = h.id;
                    Object.assign(editForm, { id: h.id, name: h.name, hp: String(h.hp) });
                }

                function onEditNameInput(e) { editForm.name = e.target.value; }

                function onEditHpInput(e) { editForm.hp = e.target.value; }

                function cancelEditing() {
                    editingId.value = null;
                    Object.assign(editForm, createEmptyHero());
                }

                return {
                    title: title,
                    heroes: heroes,
                    isEditing: isEditing,
                    editForm: editForm,
                    startEditing: startEditing,
                    onEditNameInput: onEditNameInput,
                    onEditHpInput: onEditHpInput,
                    cancelEditing: cancelEditing
                };
            }
        });

        app.mount('#app');
    })();
</script>
</body>
</html>